<div class="flex flex-1 flex-row" *ngIf="{activeTab : activeTab | async, 
        totalRecords: totalRecords | async, 
        groupCenturies : groupCenturies | async, 
        activeDate : activeDate | async, 
        activeLocation : activeLocation | async,
        activeType : activeType | async,
        activeFile : activeFile | async, 
        groupLocations : groupLocations | async,
        groupType : groupTypes | async,
        groupLanguage : groupLanguages | async,
        groupMaterial : groupMaterial | async,
        groupObjectTypes : groupObjectTypes | async} as text">

        <div id="left-bar" class="flex flex-column">
            <p-tabView *ngIf="!text.activeFile" class="normal-tabview">
        
                <p-tabPanel header="Categories">
        
                    <ul class="home-menu">
        
                        <a *ngFor="let filter of allowedFilters" (click)="getAllData()" [href]="'/texts?filter='+filter"
                            class="categories no-underline" routerLink="./" [queryParams]="{filter : filter}" routerLinkActive="active"
                            [routerLinkActiveOptions]="{exact : false}">
                            <li class="pl-4 flex align-items-center">
                                <span class="icon"></span>
                                <span class="route flex-1">{{filter | titlecase}}</span>
                            </li>
                        </a>
                    </ul>
                </p-tabPanel>
        
                <p-tabPanel class="flex flex-column flex-1" header="Simple search">
                    <form id="search-form" class="flex flex-column flex-auto h-full" [formGroup]="searchForm">


                        <p-panel header="Full Text" [toggleable]="false">
                            <div class="flex-column start">
                                <div id="text-radio-button" class="pt-2 p-inputgroup">
                                    <input id="float-input" type="text"
                                        [placeholder]="!searchForm.get('greekMode')?.value  ? 'Eg: legù' : 'Eg: λεγϋ'"
                                        formControlName="fullText" pInputText> 
                                    <p-toggleButton styleClass="border-noround" formControlName="fullTextExactMatch" onIcon="exact" offIcon="contains"
                                        [pTooltip]="searchForm.get('fullTextExactMatch')?.value ? 'Exact match: true' : 'Exact match: false'"
                                        tooltipPosition="right"></p-toggleButton>
                                    <p-toggleButton formControlName="greekMode" onIcon="omega" offIcon="latin"
                                        [pTooltip]="searchForm.get('greekMode')?.value ? 'Greek keyboard' : 'Latin keyboard'"
                                        tooltipPosition="right"></p-toggleButton>
                                </div>
                            
                            </div>
                        </p-panel>

                        <p-panel header="Title and Id's" [toggleable]="true" [collapsed]="true" [toggler]="'header'">
                            <div class="flex-column start">
                                <div id="text-radio-button" class="pt-2 p-inputgroup">
                                    <input id="float-input" type="text"
                                        placeholder="Enter title..."
                                        formControlName="title" pInputText> 
                                    <p-toggleButton formControlName="titleExactMatch" onIcon="exact" offIcon="contains"
                                        [pTooltip]="searchForm.get('titleExactMatch')?.value ? 'Exact match: true' : 'Exact match: false'"
                                        tooltipPosition="right"></p-toggleButton>
                                </div>

                                <div id="text-radio-button" class="pt-2 p-inputgroup">
                                    <input id="float-input" type="text"
                                        placeholder="Enter ID..."
                                        formControlName="id" pInputText> 
                                    <p-toggleButton formControlName="idExactMatch" onIcon="exact" offIcon="contains"
                                        [pTooltip]="searchForm.get('idExactMatch')?.value ? 'Exact match: true' : 'Exact match: false'"
                                        tooltipPosition="right"></p-toggleButton>
                                </div>
                               <!--  <div class="mt-4">
                                    <p-selectButton [options]="searchOptions" formControlName="searchMode"></p-selectButton>
                                </div> -->
                            </div>
                        </p-panel>

                        <p-panel class="cursor-pointer" header="Date" [toggleable]="true" [collapsed]="true" [toggler]="'header'">
                            <div class="flex pt-3">
                                <p-checkbox [(ngModel)]="isActiveInterval" [binary]="true" label="Interval" [ngModelOptions]="{standalone: true}"></p-checkbox>
                            </div>
                            <div class="flex pt-3">
                                <p-dropdown appendTo="body" [showClear]="true" class="flex-auto" [options]="(text.groupCenturies) || []" formControlName="fromDate"
                                    optionValue="century" optionLabel="label" placeholder="Eg: 6th century BC">
                                    <ng-template let-date pTemplate="item">
                                        <div class="century-item">
                                            <span class="counter">{{date.label}}</span>
                                        </div>
                                    </ng-template>
                                </p-dropdown>
                            </div>

                            <div class="flex pt-3" *ngIf="isActiveInterval">
                                <p-dropdown appendTo="body"  [showClear]="true" class="flex-auto" [options]="(text.groupCenturies) || []" formControlName="toDate"
                                    optionValue="century" optionLabel="label" placeholder="Eg: 6th century BC">
                                    <ng-template let-date pTemplate="item">
                                        <div class="century-item">
                                            <span class="counter">{{date.label}}</span>
                                        </div>
                                    </ng-template>
                                </p-dropdown>
                            </div>
                        </p-panel>

                        <p-panel class="cursor-pointer" header="Location" [toggleable]="true" [collapsed]="true" [toggler]="'header'">

                            <p-autoComplete formControlName="place" 
                                            [suggestions]="(searchLocations | async) || []" 
                                            (completeMethod)="autocomplete$.next($event)"
                                            field="ancientPlaceLabel"
                                            placeholder="Eg: Samnium">

                                            <ng-template let-item pTemplate="item">
                                                <div>{{item.ancientPlaceLabel}}</div>
                                                <sub>{{item.modernPlaceLabel}}</sub>
                                            </ng-template>
                            </p-autoComplete>

                        </p-panel>


                        <p-panel class="cursor-pointer" header="Language" [toggleable]="true" [collapsed]="true" [toggler]="'header'">
                            
                            <div class="flex pt-3">
                                <p-dropdown appendTo="body" [showClear]="true" class="flex-auto" [options]="(text.groupLanguage) || []" formControlName="language"
                                    optionValue="language" optionLabel="language" placeholder="Select language...">
                                    <ng-template let-item pTemplate="item">
                                        <div class="language-item">
                                            <span class="counter">{{item.language}} - {{item.count}}</span>
                                        </div>
                                    </ng-template>
                                </p-dropdown>
                            </div>

            
                        </p-panel>

                        <p-panel class="cursor-pointer" header="Inscription Types" [toggleable]="true" [collapsed]="true" [toggler]="'header'">
                            
                            <div class="flex pt-3">
                                <p-dropdown appendTo="body" [showClear]="true" class="flex-auto" [options]="(text.groupType) || []" formControlName="inscriptionType"
                                    optionValue="inscriptionType" optionLabel="inscriptionType" placeholder="Select inscription type...">
                                    <ng-template let-inscriptionType pTemplate="item">
                                        <div class="language-item">
                                            <span class="counter">{{inscriptionType.inscriptionType}}</span>
                                        </div>
                                    </ng-template>
                                </p-dropdown>
                            </div>

            
                        </p-panel>


                        <p-panel class="cursor-pointer" header="Object Types" [toggleable]="true" [collapsed]="true" [toggler]="'header'">
                            
                            <div class="flex pt-3">
                                <p-dropdown [appendTo]="'body'" [showClear]="true" class="flex-auto" [options]="(text.groupObjectTypes) || []" formControlName="objectType"
                                    optionValue="century" optionLabel="label" placeholder="Select object type...">
                                    <ng-template let-objectType pTemplate="item">
                                        <div class="language-item">
                                            <span class="counter">{{objectType.objectType}}</span>
                                        </div>
                                    </ng-template>
                                </p-dropdown>
                            </div>

            
                        </p-panel>

                        <p-panel class="cursor-pointer" header="Materials" [toggleable]="true" [collapsed]="true" [toggler]="'header'">
                            
                            <div class="flex pt-3">
                                <p-dropdown appendTo="body" [showClear]="true" class="flex-auto" [options]="(text.groupMaterial) || []" formControlName="materials"
                                    optionValue="century" optionLabel="label" placeholder="Select material...">
                                    <ng-template let-materials pTemplate="item">
                                        <div class="language-item">
                                            <span class="counter">{{materials.material}}</span>
                                        </div>
                                    </ng-template>
                                </p-dropdown>
                            </div>

            
                        </p-panel>


                        <div class="flex pt-3 mb-0 mt-auto search-button-div sticky bottom-0">
                            <button pButton 
                                    type="button"
                                    label="Clear" 
                                    class="p-button-danger border-noround flex-1"
                                    icon="fa-solid fa-times" 
                                    iconPos="left">
                            </button>
                            <button pButton 
                                    type="button"
                                    label="Search" 
                                    class="p-button-secondary border-noround flex-1"
                                    icon="fa-solid fa-search" 
                                    iconPos="right">
                            </button>
                        </div>

    
                    </form>
                </p-tabPanel>
        
            </p-tabView>

            <ul class="home-menu" *ngIf="text.activeFile">
        
                <!-- ATTESTATIONS -->
                <!-- <a  class="categories no-underline">
                    <li class="pl-4 flex align-items-center">
                        <span class="icon"></span>
                        <span class="route flex-1">Attestations</span>
                    </li>
                </a> -->

                <!-- HOW TO CITE -->
                <!-- <a  class="categories no-underline">
                    <li class="pl-4 flex align-items-center">
                        <span class="icon"></span>
                        <span class="route flex-1">How to cite</span>
                    </li>
                </a> -->
                <!-- SHOW XML -->
                <a  class="categories no-underline">
                    <li class="pl-4 flex align-items-center">
                        <span class="icon"></span>
                        <span class="route flex-1">Show XML</span>
                    </li>
                </a>
                <!-- PRINT/PDF ? -->
                <a  class="categories no-underline">
                    <li class="pl-4 flex align-items-center">
                        <span class="icon"></span>
                        <span class="route flex-1">Print/Save PDF</span>
                    </li>
                </a>

                <!-- SHOW HIDE RESTORATIONS -->
                <a  class="categories no-underline" (click)="showHideRestorations()">
                    <li class="pl-4 flex align-items-center">
                        <span class="icon"></span>
                        <span class="route flex-1">Show/Hide restorations</span>
                    </li>
                </a>
            </ul>
        
        </div>
        
        <div id="texts-container" class="flex flex-column flex-1">

            <!-- TEXT FILTER ALL -->
            <div id="filter-texts-container" class="flex flex-column text-container-top" *ngIf="text.activeTab == 'all'">
                <div class="flex flex-row align-items-center horizontal-list m-3 text-center">
                    <h2 class="flex-1 loading" *ngIf="!(text.totalRecords) && ! somethingWrong">Loading <span>.</span><span>.</span><span>.</span>
                    </h2>
                    <h2 class="flex-1" *ngIf="somethingWrong">Ops!</h2>
                    <h2 class="flex-1" *ngIf="(text.totalRecords)"><span class="red">{{text.totalRecords}} </span>texts found
                    </h2>
                </div>
        
        
            </div>
        
            
            <!-- TEXT FILTER DATE -->
            <div id="filter-date-container" class="flex flex-column text-container-top" *ngIf="text.activeTab == 'date'">
                <div class="flex flex-row horizontal-list m-3 text-container-top">
                    <h2 class="loading text-center flex-1 flex align-items-center justify-content-center"
                        *ngIf="!text.groupCenturies">Loading <span>.</span><span>.</span><span>.</span></h2>
        
                    <ul class="flex-wrap align-items-center" *ngIf="text.groupCenturies">
        
                        <li *ngFor="let item of text.groupCenturies" [class.active]="text.activeDate == item.century"
                            (click)="filterByDate(item.century)"
                            class="my-2 mr-2 align-items-center border-round-2xl century-list-element" routerLink="./"
                            [queryParams]="{filter: 'date', date: item.century}">
                            <p-badge class="p-2 pr-0" value="{{item.count}}"></p-badge>
                            <a class="no-underline font-bold">{{item.century | centuryPipe}}</a>
                        </li>
        
        
                    </ul>
                </div>
            </div>
            

            <!-- TEXT FILTER LOCATION -->
            <div id="filter-location-container" class="flex flex-column" *ngIf="text.activeTab == 'location'">
        
                <div class="flex flex-row horizontal-list m-3 text-container-top justify-content-between">
        
                    <h2 class="loading text-center flex-1 flex align-items-center justify-content-center"
                        *ngIf="!text.groupLocations">Loading <span>.</span><span>.</span><span>.</span>
                    </h2>
                    <ul class="flex-wrap align-items-center" *ngIf="text.groupLocations">
                        <li *ngFor="let item of text.groupLocations"
                            class="my-2 mr-2 align-items-center border-round-2xl century-list-element" routerLink="./"
                            [class.active]="(text.activeLocation == item.ancientPlaceId)"
                            [queryParams]="{filter: 'location', place: ((item.ancientPlaceId == '' || item.ancientPlaceId == 'unknown') ? item.modernPlaceId : item.ancientPlaceId)}">
                            <p-badge class="p-2 pr-0" value="{{item.count}}"></p-badge>
                            <a class="no-underline font-bold">{{(item.ancientPlaceLabel == '' || item.ancientPlaceLabel ==
                                'unknown') ? item.modernPlaceLabel : item.ancientPlaceLabel}}</a>
        
                        </li>
                    </ul>
                    <div class="flex align-items-center map-button" *ngIf="{geoData: geoData | async} as map">
                        <button (click)="overlayGeneralMap.toggle($event)" pButton type="button" class="p-button-secondary mr-2"
                            icon="fa-solid fa-map-location-dot" iconPos="left"></button>
        
                        <p-overlayPanel #overlayGeneralMap [appendTo]="'body'">
                            <ng-template pTemplate>
                                <div class="relative mb-3" style="width: 400px;"
                                    *ngIf="{geoData : getGeoData.next((text.groupLocations) || [])} as map">
                                    <div style="height: 400px;" leaflet [leafletOptions]="leafletMapOptions" [leafletLayers]="layers"
                                        [leafletMaxBounds]="bounds">
                                    </div>
                                </div>
                            </ng-template>
                        </p-overlayPanel>
                    </div>
                </div>
        
            </div>


            <!-- TEXTS FILTER BY TYPE -->
            <div id="filter-type-container" class="flex flex-column text-container-top" *ngIf="text.activeTab == 'type'">
                <div class="flex flex-row horizontal-list m-3 text-container-top">
                    <h2 class="loading text-center flex-1 flex align-items-center justify-content-center"
                        *ngIf="!text.groupType">Loading <span>.</span><span>.</span><span>.</span></h2>
        
                    <ul class="flex-wrap align-items-center" *ngIf="text.groupType">
        
                        <li *ngFor="let item of text.groupType" [class.active]="text.activeType == item.inscriptionType"
                            (click)="filterByType(item.inscriptionType)"
                            class="my-2 mr-2 align-items-center border-round-2xl type-list-element" routerLink="./"
                            [queryParams]="{filter: 'type', type: item.inscriptionType | urlDecoder}">
                            <p-badge class="p-2 pr-0" value="{{item.count}}"></p-badge>
                            <a class="no-underline font-bold">{{item.inscriptionType}}</a>
                        </li>
        
        
                    </ul>
                </div>
            </div>
        
            <!-- TEXTS LIST -->
            <div class="flex flex-row flex-wrap flex-auto text-item-container p-3" *ngIf="(text.totalRecords != 0 && !somethingWrong) && !text.activeFile">
                <div class="flex flex-row m-2 w-full" *ngIf="!text.totalRecords">
                    <p-progressSpinner class="flex flex-1"></p-progressSpinner>
        
                </div>
        
                <a class="flex no-underline text-item m-2" *ngFor="let item of paginationItems | async"
                    [href]="'/text?file='+item.fileID" routerLink="./" [queryParams]="{file: item.fileID}">

                    <div class="flex flex-row  ">
                        <div class="flex text-item-id p-2">
                            {{item.itAnt_ID}}
                        </div>
        
                        <div class="flex flex-column text-item-preview p-2">
        
                            <div class="text-item-preview-top">
                                {{item.inscriptionTitle != '' ? item.inscriptionTitle : item.itAnt_ID}}
                            </div>
        
                            <div class="text-item-preview-bottom flex flex-column mt-3">
                                <div class="flex flex-row align-items-baseline">
                                    <i class="far fa-calendar-alt"></i>
                                    <span class="ml-2">{{item.dateOfOrigin}}</span>
                                </div>
                                <div class="flex flex-row align-items-baseline mt-2">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span class="ml-2">{{item.originalPlace.ancientName}}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </a>
        
            </div>


            <!-- TEXT VIEW -->
            <div class="flex flex-row flex-wrap flex-auto text-item-container p-3" *ngIf="((text.totalRecords != 0 && !somethingWrong) && text.activeFile) 
                                                                                        && {index : getTextPaginationIndex | async,
                                                                                            fileID: getFileIdByIndex | async, 
                                                                                            file : getFileByIndex | async} as textView">
                
                <div class="flex flex-column flex-auto ">
                    <div class="flex flex-row horizontal-list m-3 text-container-top sticky top-0">
                        <p-paginator *ngIf="(text.totalRecords != 0 && !somethingWrong)"
                            id="text-view-paginator"
                            [dropdownAppendTo]="'body'" [first]="(textView.index) || 0" [rows]="1"
                            [totalRecords]="(totalRecords | async) || 0"
                            (onPageChange)="textPagination($event)"
                            [showJumpToPageDropdown]="false" 
                            [showPageLinks]="false">
                    
                        </p-paginator>

                        <div id="text-view-id" class="select-none absolute h-full flex justify-content-center align-items-center">
                            
                            <div *ngIf="!textView.file">
                                <i class="fas fa-spinner fa-pulse"></i>
                            </div>
                            <div class="flex flex-column align-items-center" *ngIf="textView.file">
                                <h2 class="font-bold">{{textView.file?.itAnt_ID}}</h2>
                                <h3 class="font-italic font-normal">{{textView.file.inscriptionTitle != '' ? textView.file.inscriptionTitle : textView.file.title}}</h3>
                            </div>
                        </div>

                        
                    </div>         
                    
                    
                    <div class="main-section flex flex-column m-3" *ngIf="textView.file">


                        <!-- GENERAL -->
                        <div id="general-data-div" class="flex flex-column flex-auto">
                            <div id="general-data-div-title" class="flex flex-row">
                                <h2 class="font-medium">General data:</h2>
                            </div>
                            
                            <div id="general-data-div-list" class="flex grid data-list  pt-3 ">
                                <div class="flex col-3 justify-content-end">
                                    <span class="font-bold">ID:</span>
                                </div>
                                <div class="flex flex-row col-9">

                                    <span class="font-normal">{{textView.file.itAnt_ID}}</span>

                                    <div class="flex flex-column" *ngIf="textView.file.traditionalIDs.length > 0">

                                        <div class="flex flex-column">
                                            <a class="font-bold text-red-800 pl-2" *ngFor="let traditionalIDs of textView.file.traditionalIDs" [href]="traditionalIDs.traditionalID_URL" target="_blank">{{traditionalIDs.traditionalID}}</a>

                                        </div>
                                        
                                        <div class="flex flex-row pl-2" *ngIf="textView.file.trismegistos">
                                            <a [href]="'//'+textView.file.trismegistos.trismegistosID_url" target="_blank" class="font-bold text-red-800">{{textView.file.trismegistos.trismegistosID}}</a>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <div id="general-data-div-list" class="flex grid data-list">
                                <div class="flex col-3 justify-content-end">
                                    <span class="font-bold">Title:</span>
                                </div>
                                <div class="flex flex-row col-9">

                                    <span class="font-normal">{{textView.file.title}}</span>

                                    
                                </div>
                            </div>
                        </div>  


                        <!-- TEXT -->

                        <div id="edition-div" class="flex flex-column flex-auto pt-3" *ngIf="{raw : getXMLContent | async } as xml">
                            <div id="edition-div-title" class="flex flex-row">
                                <h2 class="font-medium">Text</h2>
                                
                            </div>

                            <div id="edition-div-panel" class="flex data-list  pt-3" *ngIf="{interpretative: getInterpretativeContent | async,
                                                                                             diplomatic : getDiplomaticContent | async,
                                                                                             annotations: getAnnotations | async} as leiden"> 
                                <p-tabView styleClass="text-panel" [hidden]="loadingInterpretative && loadingDiplomatic">
                                    <p-tabPanel header="Intepretative">
                                        <div #interpretativeText id="interpretative-text" [hidden]="loadingInterpretative" [innerHTML]="leiden.interpretative | noSanitize " >

                                            
                                        </div>
                                        <div #dynamicOverlay></div>
                                    </p-tabPanel>
                                    <p-tabPanel header="Diplomatic">
                                        <div #diplomaticText id="diplomatic-text" [hidden]="loadingDiplomatic" [innerHTML]="leiden.diplomatic">

                                        </div>
                                    </p-tabPanel>
    
                                </p-tabView>                              
                                 
                                
                            </div>
                            <div class="flex flex-row m-2 w-full" *ngIf="loadingInterpretative || loadingDiplomatic">
                                <p-progressSpinner class="flex flex-1"></p-progressSpinner>
                    
                            </div>
                        </div> 
                        
                        
                        <div id="translation-div" class="flex flex-column flex-auto pt-3" *ngIf="{raw : getXMLContent | async } as xml">
                            <div id="translation-div-title" class="flex flex-row">
                                <h2 class="font-medium">Translation</h2>
                                
                            </div>

                            <div id="translation-div-panel" class="flex data-list" *ngIf="{data: getTranslation | async } as translation"> 

                                <!-- {{translation.data | json}} -->
                                <div *ngIf="!loadingTranslation">

                                    <div class="grid m-3" *ngIf="translation.data.length > 0">
                                        <div class="col-12 lg:col-6 font-light" *ngFor="let trans of translation.data" [innerHTML]="trans">
    
                                        </div>
                                
                                    </div>
    
                                    <div class="font-italic font-light m-3" *ngIf="translation.data.length == 0">
                                        No translation
                                    </div>
                                </div>
                                
                            </div>
                            <div class="flex flex-row m-2 w-full" *ngIf="loadingTranslation">
                                <p-progressSpinner class="flex flex-1"></p-progressSpinner>
                    
                            </div>
                        </div> 

                         <!-- SUPPORT -->

                        <!-- ORIGIN AND CONSERVATION -->

                        <!-- BIBLIOGRAPHY -->

                        <!-- ICONOGRAPHIC APPARATUS -->
                    </div>
                    

                   
                    
                </div>
                <div class="flex flex-row m-2 w-full" *ngIf="!textView.file">
                    <p-progressSpinner class="flex flex-1"></p-progressSpinner>
        
                </div>
            </div>
        
            <p-paginator *ngIf="(text.totalRecords != 0 && !somethingWrong) && !text.activeFile" [dropdownAppendTo]="'body'" [first]="first" [rows]="rows"
                [totalRecords]="(totalRecords | async) || 0"
                (onPageChange)="pagination($event, (text.activeTab || null), (text.activeDate || null), (text.activeLocation || null), (text.activeType || null))"
                [showJumpToPageDropdown]="true" [rowsPerPageOptions]="[6,12,24]"></p-paginator>
        
            <div class="flex flex-row flex-wrap flex-auto text-item-container p-3" *ngIf="text.totalRecords == 0 && !somethingWrong">
                no entries
            </div>

            <div class="flex flex-row flex-wrap flex-auto text-item-container p-3" *ngIf="somethingWrong">
                Something went wrong
            </div>
        </div>

</div>

